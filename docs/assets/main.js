!function(){"use strict";var e;const t=function(t){window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")&&(window.AudioContext=globalThis.webkitAudioContext),navigator.hasOwnProperty("webkitGetUserMedia")&&!navigator.hasOwnProperty("getUserMedia")&&(navigator.getUserMedia=globalThis.webkitGetUserMedia,AudioContext.prototype.hasOwnProperty("createScriptProcessor")||(AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode)),this.context=new AudioContext;let o=document.getElementById("elvisSong"),n=this.context.createMediaElementSource(o);n.connect(this.context.destination),this.meyda=window.Meyda.createMeydaAnalyzer({audioContext:this.context,source:n,bufferSize:t,windowingFunction:"blackman"}),e=this,this.initializeMicrophoneSampling()};t.prototype.initializeMicrophoneSampling=function(){var t=function(t){if("suspended"===e.context.state){var o=function(){e.context.resume(),setTimeout((function(){"running"===e.context.state&&document.body.removeEventListener("touchend",o,!1)}),0)};document.body.addEventListener("touchend",o,!1)}};try{navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.getUserMedia||navigator.mediaDevices.getUserMedia;var o=function(t){document.getElementById("audioControl").style.display="none",console.log("User allowed microphone access."),console.log("Initializing AudioNode from MediaStream");var o=e.context.createMediaStreamSource(t);console.log("Setting Meyda Source to Microphone"),e.meyda.setSource(o),console.groupEnd()};console.log("Asking for permission..."),navigator.mediaDevices.getUserMedia({audio:!0}).then(o).catch((function(e){console.log(e),navigator.getUserMedia({audio:!0},o,(function(e){t()}))}))}catch(e){t()}},t.prototype.get=function(t){return e.context.resume(),e.meyda.get(t)};var o=["C","C#","D","Eb","E","F","F#","G","G#","A","Bb","B"];const n=1024;let r=new t(n);var i=new THREE.Scene,a=new THREE.PerspectiveCamera(40,1.6,.1,1e3),c=new THREE.LineBasicMaterial({color:65280});new THREE.LineBasicMaterial({color:65535});var s=function(e,t){for(var o=[],n=0;n<e;n++)o.push(Array.apply(null,Array(t)).map(Number.prototype.valueOf,0));return o}(20,n),d=new THREE.WebGLRenderer({canvas:document.querySelector("canvas")});function l(){d.domElement.style.width="100%",d.domElement.style.height="auto";var e=d.domElement.clientWidth/16*10;d.setPixelRatio(window.devicePixelRatio?window.devicePixelRatio:1),d.setSize(1.6*e,e),d.domElement.style.width="100%",d.domElement.style.height="auto",a.aspect=1.6*e/e,a.updateProjectionMatrix()}l(),window.addEventListener("resize",l);var u=new THREE.DirectionalLight(16777215,.5);u.position.set(0,1,1),i.add(u),a.position.z=5;const m=new THREE.Vector3(0,1,0),p=new THREE.Vector3(1,0,0),g=new THREE.Vector3(1,-6,-15);let w=new THREE.ArrowHelper(m,g,1,16776960),y=new THREE.ArrowHelper(m,g,1,255),E=new THREE.ArrowHelper(p,g,1,16711935),h=new THREE.Group;i.add(w),i.add(y),i.add(E);for(let e=0;e<s.length;e++)if(s[e]){let t=new THREE.BufferGeometry,o=new Float32Array(3*s[e].length);t.addAttribute("position",new THREE.BufferAttribute(o,3)),t.setDrawRange(0,s[e].length);let n=new THREE.Line(t,c);h.add(n),o=n.geometry.attributes.position.array}let f=new THREE.BufferGeometry,v=new THREE.Line(f,c);{let e=new Float32Array(3072);f.addAttribute("position",new THREE.BufferAttribute(e,3)),f.setDrawRange(0,n),e=v.geometry.attributes.position.array}i.add(v),i.add(h);let b=null,M=document.querySelector("#chroma"),R=document.querySelector("#mfcc");!function e(){if(b=r.get(["amplitudeSpectrum","spectralCentroid","spectralRolloff","loudness","rms","chroma","mfcc"]),b){M&&b.chroma&&(M.innerHTML=b.chroma.reduce(((e,t,n)=>`${e}\n          <div class="chroma-band" style="background-color: rgba(0,${Math.round(255*t)},0,1)">${o[n]}</div>`),"")),R&&b.mfcc&&(R.innerHTML=b.mfcc.reduce(((e,t,o)=>`${e}\n          <div class="mfcc-band" style="background-color: rgba(0,${5*Math.round(t+25)},0,1)">${o}</div>`),"")),s.pop(),s.unshift(b.amplitudeSpectrum);const e=r.meyda._m.signal;for(let e=0;e<s.length;e++){for(var t=h.children[e].geometry.attributes.position.array,c=0,l=0;l<3*s[e].length;l++)t[c++]=10.7+8*Math.log10(l/s[e].length),t[c++]=.1*s[e][l]-5,t[c++]=-15-e;h.children[e].geometry.attributes.position.needsUpdate=!0}if(b.spectralCentroid&&w.position.set(10.7+8*Math.log10(b.spectralCentroid/512),-6,-15),b.spectralRolloff){var u=b.spectralRolloff/22050;y.position.set(10.7+8*Math.log10(u),-6,-15)}if(b.rms&&E.position.set(-11,10*b.rms-5,-15),e){let t=v.geometry.attributes.position.array,o=0;for(var m=0;m<n;m++)t[o++]=22*m/n-11,t[o++]=4+5*e[m],t[o++]=-25;v.geometry.attributes.position.needsUpdate=!0}}requestAnimationFrame(e),d.render(i,a)}()}();
